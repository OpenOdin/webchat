{
    "name": "webchat",
    "version": "0.1.0",
    "title": "OpenOdin Interoperable Messaging",
    "description": "",
    "homepage": "https://openodin.com",
    "author": "OpenOdin",
    "repository": "git+https://github.com/OpenOdin/webchat",
    "threads": {
        "presence": {
            "query": {
                "parentId": "0000000000000000000000000000000000000000000000000000000000000001",
                "match": [
                    {
                        "nodeType": "DataNode",
                        "filters": [
                            {
                                "field": "contentType",
                                "value": "app/chat/presence",
                                "cmp": "eq"
                            }
                        ],
                        "limitField": {
                            "name": "owner",
                            "limit": 1
                        },
                        "limit": 1000
                    }
                ],
                "depth": 1,
                "limit": 10000,
                "descending": true
            },
            "post": {
                "presence": {
                    "contentType": "app/chat/presence",
                    "isPublic": true,
                    "expireTime": -120000
                },
                "existence": {
                    " ## ": "A presence node lasting a full week to show that user exists, even if not present",
                    "contentType": "app/chat/presence",
                    "isPublic": true,
                    "expireTime": -604800000
                }
            }
        },
        "channels": {
            "query": {
                "parentId": "0000000000000000000000000000000000000000000000000000000000000002",
                "match": [
                    {
                        "nodeType": "DataNode",
                        "filters": [
                            {
                                "field": "contentType",
                                "value": "app/chat/channel",
                                "cmp": "eq"
                            }
                        ]
                    }
                ],
                "depth": 1
            },
            "crdt": {
                "algo": "Sorted",
                "tail": 20
            },
            "post": {
                "channel": {
                    "contentType": "app/chat/channel",
                    "isLicensed": true,
                    " ## ": "Set channel validity to 416 days",
                    " ## expireTime": -36000000000,

                    " ## refId": "refId must be set for private channels. It is the public key of the friend",
                    "refId": "${refId}",
                    " ## data": "data should be set to the name of the channel",
                    "data": "${data}"
                }
            },
            "postLicense": {
                "channel": {
                    "jumpPeerPublicKey": "< public key of server >"
                }
            }
        },
        "channel": {
            "query": {
                "parentId": "${parentId}",
                "match": [
                    {
                        "nodeType": "DataNode",
                        "filters": [
                            {
                                "field": "contentType",
                                "value": "app/chat/message",
                                "cmp": "eq"
                            }
                        ],
                        "level": [1],
                        "limit": "${limit}"
                    },
                    {
                        "nodeType": "DataNode",
                        "filters": [
                            {
                                "field": "contentType",
                                "value": "app/chat/message",
                                "cmp": "eq"
                            }
                        ],
                        "level": [2],
                        "limit": "${limit}"
                    }
                ],
                "descending": true,
                "depth": 2,
                "preserveTransient": true
            },
            "crdt": {
                "algo": "SortedRefId",
                "tail": 1000,
                "conf": {
                    "annotations": {
                        "format": "messages"
                    }
                }
            },
            "post": {
                "message": {
                    " ## ": "Post a chat message in the thread.",
                    "parentId": "${parentId}",

                    "bubbleTrigger": true,
                    "contentType": "app/chat/message",
                    "isLicensed": true,
                    " ## ": "Set message validity to 41 days",
                    " ## expireTime": -3600000000,

                    " ## refId": "refId should be set to the id1 of the previous message",
                    "refId": "${refId}",
                    " ## data": "data is the text of the message sent",
                    "data": "${data}"
                },
                "attachment": {
                    " ## ": "Post a attachment (file or image) in the thread.",
                    "parentId": "${parentId}",

                    "bubbleTrigger": true,
                    "contentType": "app/chat/message",
                    "isLicensed": true,
                    " ## ": "Set attachment validity to 41 days",
                    " ## expireTime": -3600000000,

                    " ## refId": "refId should be set to the id1 of the previous message",
                    "refId": "${refId}",
                    " ## blobLength": "blobLength is the size in bytes of the attachment",
                    "blobLength": "${blobLength}",
                    " ## blobHash": "blobHash is the blake2b hash of the attachment content",
                    "blobHash": "${blobHash}",
                    " ## data": "data should be set to the filename of the attachment",
                    "data": "${data}"
                }
            },
            "postLicense": {
                "default": {
                    " ## ": "Post license, same for messages and attachments",
                    "jumpPeerPublicKey": "< public key of server >",
                    " ## expireTime": "Default license validity time is 90 days for messages created.",
                    " ## expireTime": -7776000000
                }
            }
        }
    },
    "peers": [
        {
            "connection": {
                "api": {
                    "client": {
                        "socketType": "WebSocket",
                        "host": "127.0.0.1",
                        "port": 1117,
                        "serverPublicKey": "< public key of server >",
                        "reconnectDelay": 3
                    },
                    "clientAuth": {
                        "method": "handshake"
                    }
                }
            }
        }
    ]
}
